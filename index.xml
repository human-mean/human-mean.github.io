<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>åµŒå…¥å¼å­¦ä¹ ç¬”è®°</title><link>https://human-mean.github.io/</link><description>Recent content on åµŒå…¥å¼å­¦ä¹ ç¬”è®°</description><generator>Hugo -- 0.155.3</generator><language>zh-cn</language><lastBuildDate>Tue, 03 Feb 2026 00:00:00 +0000</lastBuildDate><atom:link href="https://human-mean.github.io/index.xml" rel="self" type="application/rss+xml"/><item><title>1.ARM64å¯åŠ¨æµç¨‹</title><link>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/1.arm64%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/1.arm64%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</guid><description>&lt;h2 id="starts-å¯åŠ¨ä»£ç "&gt;start.S å¯åŠ¨ä»£ç &lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;start.Sæ˜¯cpuä¸Šç”µè¿è¡Œçš„ç¬¬ä¸€æ®µä»£ç ,è´Ÿè´£åˆå§‹åŒ–ç¡¬ä»¶ç¯å¢ƒå¹¶ä¸”ä¸ºç¨‹åºè¿è¡Œåšå‡†å¤‡ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id="è®¾ç½®æ ˆæŒ‡é’ˆ"&gt;è®¾ç½®æ ˆæŒ‡é’ˆ&lt;/h4&gt;
&lt;p&gt;cè¯­è¨€çš„å‡½æ•°è°ƒç”¨æ ˆæ¥ä¿å­˜è¿”å›åœ°å€ã€å±€éƒ¨å˜é‡å’Œå‡½æ•°å‚æ•°ï¼Œè¿›å…¥cä»£ç ä¹‹å‰å¿…é¡»ä¸ºæ ˆæŒ‡é’ˆï¼ˆspï¼‰è®¾ç½®ä¸€ä¸ªæœ‰æ•ˆå€¼ã€‚æ ˆä»é«˜åœ°å€å‘ä½åœ°å€ç”Ÿé•¿ï¼Œæ‰€ä»¥æ ˆæŒ‡é’ˆåˆå§‹åŒ–ä¸ºRAMçš„é«˜åœ°å€è¾¹ç•Œã€‚&lt;/p&gt;
&lt;h4 id="æ¸…ç©º-bss-æ®µ"&gt;æ¸…ç©º BSS æ®µ&lt;/h4&gt;
&lt;p&gt;BSSç”¨äºå­˜å‚¨ä¸ºåˆå§‹åŒ–çš„å…¨å±€å’Œå±€éƒ¨å˜é‡ï¼Œå¦‚æœä¸æ‰‹åŠ¨å°†BSSæ®µæ¸…é›¶ï¼Œä¸Šç”µåçš„RAMå†…å®¹ä¼šæ˜¯ä¸ç¡®å®šçš„éšæœºå€¼ã€‚&lt;/p&gt;
&lt;h4 id="bss-æ®µçš„ä¼˜åŒ–æ„ä¹‰"&gt;BSS æ®µçš„ä¼˜åŒ–æ„ä¹‰&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;å‡å°äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°&lt;/strong&gt;ï¼šæœªåˆå§‹åŒ–çš„å˜é‡ä¸å ç”¨æ–‡ä»¶ç©ºé—´&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;åŠ å¿«åŠ è½½é€Ÿåº¦&lt;/strong&gt;ï¼šåªéœ€è®°å½•å¤§å°ï¼Œè¿è¡Œæ—¶æ¸…é›¶&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç»Ÿä¸€åˆå§‹åŒ–&lt;/strong&gt;ï¼šä¿è¯æ‰€æœ‰æœªåˆå§‹åŒ–å˜é‡çš„åˆå§‹å€¼ä¸ºé›¶&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="bssæ®µæ¸…é›¶ä¸èƒ½ç”¨memset"&gt;BSSæ®µæ¸…é›¶ä¸èƒ½ç”¨&lt;code&gt;memset&lt;/code&gt;&lt;/h4&gt;
&lt;p&gt;&lt;code&gt;memset&lt;/code&gt;æ˜¯cåº“å‡½æ•°ï¼Œå…¶å®ç°æœ¬èº«å¯èƒ½ä½¿ç”¨ä¸ºåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼Œæˆ–éœ€è¦å·²ç»åˆå§‹åŒ–çš„æ ˆï¼ŒBSSæ¸…é›¶å‰è°ƒç”¨&lt;code&gt;memset&lt;/code&gt;ä¼šå¯¼è‡´å¾ªç¯ä¾èµ–ã€‚&lt;/p&gt;
&lt;h4 id="è·³è½¬åˆ°-main"&gt;è·³è½¬åˆ° main&lt;/h4&gt;
&lt;p&gt;åº•å±‚ç¡¬ä»¶åˆå§‹åŒ–å®Œæˆåå°†æ§åˆ¶æƒäº¤ç»™cç¨‹åºå…¥å£ç‚¹&lt;code&gt;main&lt;/code&gt;ã€‚&lt;/p&gt;
&lt;h2 id="å†™ä»£ç "&gt;å†™ä»£ç &lt;/h2&gt;
&lt;h4 id="é“¾æ¥è„šæœ¬"&gt;é“¾æ¥è„šæœ¬&lt;/h4&gt;
&lt;p&gt;é“¾æ¥è„šæœ¬ç”¨äºå‘Šè¯‰è¿æ¥å™¨ä»£ç å’Œæ•°æ®æ”¾åœ¨å†…å¯¸çš„å“ªä¸ªä½ç½®ã€‚&lt;/p&gt;
&lt;p&gt;ä¸‹é¢æ˜¯æœ€ç®€å•çš„é“¾æ¥è„šæœ¬ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;ENTRY(_start) //ENTRYæŒ‡å®šå…¥å£ç¬¦å·ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰é“¾æ¥è„šæœ¬ä»å“ªé‡Œå¼€å§‹
SECTIONS{
. = 0x40000000;
.text : {
src/start.o(.text)
*(.text)
}
. = ALIGN(16); //ARM64è¦æ±‚æ ˆæŒ‡é’ˆå¿…é¡»16å­—èŠ‚å¯¹é½ï¼Œåœ¨å®šä¹‰æ ˆæˆ–è€…æ•°æ®æ®µä¹‹å‰è¦å¯¹é½å…«å­—èŠ‚ã€‚
_stack_top = . + 0x10000;
}
/*
â€˜.â€™ æ˜¯ä½ç½®è®¡æ•°å™¨ï¼Œ. = `0x40000000` æ„æ€æ˜¯ä» 0x40000000 å¼€å§‹æ”¾ä¸œè¥¿ã€‚
*/
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="starts"&gt;start.S&lt;/h4&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;.global _start
_start:
ldr x0, =_stack_top
mov sp, x0
bl main
/*
ä¼ é€’æ ˆé¡¶åœ°å€ç»™sp
*/
&lt;/code&gt;&lt;/pre&gt;&lt;h4 id="ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥å†™mov-x0-_stack_top"&gt;ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥å†™&lt;code&gt;mov x0, _stack_top&lt;/code&gt;?&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;æŸ¥é˜…æ•°æ®æ‰‹å†Œå¯ä»¥çŸ¥é“ï¼ŒMOVæŒ‡ä»¤ç«‹å³æ•°æœ€å¤§å°±æ˜¯16ä½ï¼Œæ— æ³•é€šè¿‡ä¸€æ¬¡æŒ‡ä»¤è¡¨ç¤º&lt;code&gt;0x40010000&lt;/code&gt;è¿™ç§ä»»æ„åœ°å€&lt;/p&gt;</description></item><item><title>2.æ‰“å°hello world</title><link>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/2.%E6%89%93%E5%8D%B0hello-world/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/2.%E6%89%93%E5%8D%B0hello-world/</guid><description>&lt;h2 id="é˜…è¯»æ‰‹å†Œ"&gt;é˜…è¯»æ‰‹å†Œ&lt;/h2&gt;
&lt;p&gt;æˆ‘ä»¬éœ€è¦æ‰“å°helloworldï¼Œéœ€è¦çŸ¥é“ä¸¤ä¸ªäº‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1.å­—ç¬¦å¾€å“ªé‡Œå†™ &lt;br&gt;
2.ä»€ä¹ˆæ—¶å€™å¯ä»¥å†™&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;ä¸ºæ­¤æˆ‘ä»¬éœ€è¦æ‰¾åˆ°&lt;code&gt;DR&lt;/code&gt;å’Œ&lt;code&gt;FR&lt;/code&gt;&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;å¯„å­˜å™¨&lt;/th&gt;
&lt;th&gt;ä½œç”¨&lt;/th&gt;
&lt;th&gt;ä¸ºä»€ä¹ˆéœ€è¦&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;DR(Data Register)&lt;/td&gt;
&lt;td&gt;æ•°æ®å¯„å­˜å™¨&lt;/td&gt;
&lt;td&gt;å†™å…¥çš„å­—ç¬¦ä»DRå‘å‡º&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;FR(Flag Register)&lt;/td&gt;
&lt;td&gt;çŠ¶æ€å¯„å­˜å™¨&lt;/td&gt;
&lt;td&gt;å¾—çŸ¥ç¼“å†²åŒºæ˜¯å¦æ»¡äº†&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;&lt;img src="https://human-mean.github.io/posts/ARM64%20Hypervisor%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/images/UARTDR.png" alt="" loading="lazy" /&gt;
&lt;strong&gt;DRå¯„å­˜å™¨çš„åç§»é‡ä¸º0x000&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;img src="https://human-mean.github.io/posts/ARM64%20Hypervisor%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/images/UARTFR.png" alt="" loading="lazy" /&gt;
&lt;strong&gt;FRå¯„å­˜å™¨çš„åç§»é‡ä¸º0x018&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;æ¥ä¸‹æ¥æŸ¥æ‰¾TXFFçš„ä½å®šä½ã€‚
&lt;img src="https://human-mean.github.io/posts/ARM64%20Hypervisor%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/images/UARTTXFF.png" alt="" loading="lazy" /&gt;
&lt;strong&gt;TXFF&lt;/strong&gt;æ˜¯bit5&lt;/p&gt;
&lt;p&gt;çŸ¥é“äº†å¯„å­˜å™¨åç§»é‡å’Œä½å®šä½åå¼€å§‹å†™uart.h&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;#ifndef __UART_H__
#define __UART_H__
#define UART_BASE 0x09000000
#define UART_DR (UART_BASE + 0x000)
#define UART_FR (UART_BASE + 0x018)
#define UART_TXFF (1&amp;lt;&amp;lt;5)
#endif
&lt;/code&gt;&lt;/pre&gt;&lt;h2 id="uartcå®ç°"&gt;uart.cå®ç°&lt;/h2&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;void uart_putc(char c)
{
while(UART_FR &amp;amp; UART_TXFF); //åˆ¤æ–­ç¼“å†²åŒºæ˜¯å¦ä¸ºæ»¡
UART_DR = c;
}
void uart_puts(char *s)
{
while (*s){
uart_putc(*s++);
}
}
&lt;/code&gt;&lt;/pre&gt;</description></item><item><title>3.å®ç°å¼‚å¸¸å‘é‡è¡¨</title><link>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/3.%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%B8%B8%E5%90%91%E9%87%8F%E8%A1%A8/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/3.%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%B8%B8%E5%90%91%E9%87%8F%E8%A1%A8/</guid><description>&lt;blockquote&gt;
&lt;p&gt;è™½ç„¶ç°åœ¨èƒ½å¤Ÿè·‘helloworldï¼Œä½†å¦‚æœé‡åˆ°é”™è¯¯ï¼ˆæ¯”å¦‚è®¿é—®éæ³•åœ°å€ï¼‰ï¼ŒCPUä¼šæŒ‚æ­»ä¸”æ²¡æœ‰æç¤ºï¼Œå¼‚å¸¸å‘é‡è¡¨å¯ä»¥è®©æˆ‘ä»¬è·å–é”™è¯¯ä¿¡æ¯ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id="é˜…è¯»æ‰‹å†Œ"&gt;é˜…è¯»æ‰‹å†Œ&lt;/h2&gt;
&lt;p&gt;æ‰¾åˆ°æ‰‹å†Œã€ŠDDI0487_M_a_a_a-profile_architecture_reference_manualã€‹
&lt;img src="https://human-mean.github.io/posts/ARM64%20Hypervisor%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/images/exception_vector.png" alt="" loading="lazy" /&gt;
&lt;/p&gt;
&lt;h3 id="ä»€ä¹ˆæ˜¯å¼‚å¸¸"&gt;ä»€ä¹ˆæ˜¯å¼‚å¸¸&lt;/h3&gt;
&lt;p&gt;åœ¨CPUè¿è¡Œçš„æ—¶å€™ï¼Œé‡åˆ°è¢«æ‰“æ–­çš„äº‹ä»¶å°±ç§°ä½œå¼‚å¸¸ï¼Œè¿™æ˜¯ä¸€ä¸ªæŠ€æœ¯æœ¯è¯­ï¼Œå¹¶ä¸å¸¦è´¬ä¹‰ã€‚CPUè¢«æ‰“æ–­åéœ€è¦çŸ¥é“è¦è·³å»é‚£å“ªé‡Œå¤„ç†ï¼Œå‘é‡è¡¨å°±æ˜¯å‘Šè¯‰cpuè·³è½¬å»å“ªé‡Œçš„ä¸€å¼ è¡¨ã€‚&lt;/p&gt;
&lt;h3 id="å¼‚å¸¸ç±»å‹"&gt;å¼‚å¸¸ç±»å‹&lt;/h3&gt;
&lt;p&gt;ARM64æœ‰&lt;strong&gt;4&lt;/strong&gt;ç§å¼‚å¸¸ç±»å‹ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;Synchronous&lt;/strong&gt;:ä»£ç ä¸»åŠ¨è§¦å‘ï¼Œå¦‚æ‰§è¡Œéæ³•æŒ‡ä»¤ï¼Œè®¿é—®éæ³•åœ°å€ï¼Œè°ƒç”¨&lt;code&gt;svc&lt;/code&gt;ç³»ç»Ÿè°ƒç”¨ã€‚å«ä½œ&lt;strong&gt;åŒæ­¥&lt;/strong&gt;æ˜¯å› ä¸ºå’Œæ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ç›¸å…³ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;IRQ&lt;/strong&gt;:å¤–éƒ¨ç¡¬ä»¶ä¸­æ–­ï¼Œå¦‚å®šæ—¶å™¨ä¸­æ–­ï¼Œä¸²å£ä¸­æ–­ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;FIQ&lt;/strong&gt;:å¿«é€Ÿä¸­æ–­ï¼Œæ¯”IRQä¼˜å…ˆçº§æ›´é«˜ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;SError&lt;/strong&gt;ç³»ç»Ÿé”™è¯¯ï¼Œæ¯”å¦‚å¤–éƒ¨å†…å­˜æ€»çº¿å‡ºé”™ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;æ¯ä¸ªå¼‚å¸¸å‘ç”Ÿçš„æ—¶å€™ï¼Œéƒ½éœ€è¦åŒºåˆ†&lt;strong&gt;çŠ¶æ€&lt;/strong&gt;ï¼ŒARM64æŒ‰ç…§ä¸¤ä¸ªç»´åº¦åŒºåˆ†ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1,å¼‚å¸¸æ¥è‡ªå½“å‰ELè¿˜æ˜¯æ›´ä½çš„EL
2.å¼‚å¸¸å‘ç”Ÿçš„æ—¶å€™ç”¨çš„å“ªä¸ªæ ˆæŒ‡é’ˆ&lt;/p&gt;
&lt;/blockquote&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;EL=Exception Level(å¼‚å¸¸çº§åˆ«)
ARM64æŠŠCPUè¿è¡Œæƒé™åˆ†æˆ4å±‚ï¼Œæ•°å­—è¶Šå¤§æƒé™è¶Šé«˜ï¼š&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;EL0 çš„ç”¨æˆ·ç¨‹åºä¸èƒ½ç›´æ¥æ“ä½œç¡¬ä»¶ï¼Œå¿…é¡»é€šè¿‡ EL1 å†…æ ¸ã€‚EL1 çš„å†…æ ¸ä¸èƒ½ç»•è¿‡ EL2 çš„ Hypervisorã€‚æ¯ä¸€å±‚åªèƒ½è®¿é—®è‡ªå·±å’Œæ›´ä½å±‚çš„èµ„æºã€‚&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;è¿™ä¸¤ä¸ªç»´åº¦å¯ä»¥ç»„åˆå‡ºå››ç»„æƒ…å†µï¼Œä¸€å…±æœ‰å››ä¸ªå…¥å£ï¼Œæ‰€ä»¥4ç»„ * 4å…¥å£= 16å…¥å£ï¼Œå¼‚å¸¸å‘é‡è¡¨æœ‰16ä¸ªå…¥å£ã€‚&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;vector.S&lt;/strong&gt;&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;/*
----------------------------
ç¬¬1ç»„ï¼šå½“å‰EL,SP_EL0
----------------------------
*/
.balign 128 //0X00 - Synchronous
b .
.balign 128 //0x080 - IRQ
b .
.balign 128 //0x100 - FIQ
b .
.balign 128 //0x180 - Serror
b .
/*
----------------------------
ç¬¬2ç»„ï¼šå½“å‰EL,SP_ELx
----------------------------
*/
.balign 128 //0x200 - Synchronous
b .
.balign 128 //0x280 - IRQ
b .
.balign 128 //0x300 - FIQ
b .
.balign 128 //0x380 - Serror
b .
/*
----------------------------
ç¬¬2ç»„ï¼šæ›´ä½çº§ELï¼ŒAArch64
----------------------------
*/
.balign 128 //0x400 - Synchronous
b .
.balign 128 //0x480 - IRQ
b .
.balign 128 //0x500 - FIQ
b .
.balign 128 //0x580 - Serror
b .
/*
----------------------------
ç¬¬4ç»„ï¼šæ›´ä½çº§EL,AArch32
----------------------------
*/
.balign 128 //0x600 - Synchronous
b .
.balign 128 //0x680 - IRQ
b .
.balign 128 //0x700 - FIQ
b .
.balign 128 //0x780 - Serror
b .
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;&lt;strong&gt;start.S&lt;/strong&gt;&lt;/p&gt;</description></item><item><title>4.æ’ç­‰æ˜ å°„MMU</title><link>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/4.%E6%81%92%E7%AD%89%E6%98%A0%E5%B0%84mmu/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/4.%E6%81%92%E7%AD%89%E6%98%A0%E5%B0%84mmu/</guid><description>&lt;blockquote&gt;
&lt;p&gt;&lt;strong&gt;ğŸ“‹ ä¸€äº›åŸºç¡€æ¦‚å¿µ&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stage 1&lt;/strong&gt;:å°†&lt;strong&gt;è™šæ‹Ÿåœ°å€ (VA)&lt;/strong&gt; è½¬æ¢ä¸º&lt;strong&gt;ç‰©ç†åœ°å€ (PA)&lt;/strong&gt;ï¼ˆåœ¨éè™šæ‹ŸåŒ–ç¯å¢ƒä¸‹ï¼‰æˆ–è€…è½¬æ¢ä¸º&lt;strong&gt;ä¸­é—´ç‰©ç†åœ°å€ (IPA)&lt;/strong&gt;ï¼ˆåœ¨è™šæ‹ŸåŒ–ç¯å¢ƒä¸‹ï¼‰ã€‚å®ƒä¸»è¦å— OS æ§åˆ¶ï¼Œç”¨æ¥åšè¿›ç¨‹éš”ç¦»ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Stage 2&lt;/strong&gt;ï¼šå°† &lt;strong&gt;IPA&lt;/strong&gt; è½¬æ¢ä¸ºçœŸæ­£çš„ &lt;strong&gt;ç‰©ç†åœ°å€ (PA)&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;h3 id="ä¸ºä»€ä¹ˆéœ€è¦mmu"&gt;ä¸ºä»€ä¹ˆéœ€è¦&lt;strong&gt;MMU&lt;/strong&gt;ï¼Ÿ&lt;/h3&gt;
&lt;p&gt;è£¸æœºä»£ç ä¸­CPUå‘é€çš„åœ°å€ç›´æ¥å‘é€åˆ°ç‰©ç†å†…å­˜ã€‚ä½†å­˜åœ¨å‡ ä¸ªé—®é¢˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;æ‰€æœ‰ä»£ç éƒ½èƒ½è®¿é—®æ‰€æœ‰åœ°å€ï¼Œæ²¡æœ‰ä¿æŠ¤&lt;/li&gt;
&lt;li&gt;è‹¥è·‘å¤šä¸ªGuest OS,åœ°å€ä¼šå­˜åœ¨å†²çª&lt;/li&gt;
&lt;li&gt;æ²¡æ³•æ§åˆ¶æŸæ®µå†…å­˜æ˜¯ cacheable è¿˜æ˜¯ device ç±»å‹&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;MMUå°±æ˜¯åœ¨CPUå’Œç‰©ç†å†…å­˜ä¸­å……å½“äº†ç¿»è¯‘ï¼šCPUå‘é€è™šæ‹Ÿåœ°å€ï¼ˆVAï¼‰ï¼ŒMMUé€šè¿‡æŸ¥è¡¨ç¿»è¯‘æˆç‰©ç†åœ°å€ï¼ˆPAï¼‰ï¼ŒåŒæ—¶é™„å¸¦æƒé™å’Œå±æ€§çš„ä¿¡æ¯ã€‚MMUæŸ¥çš„è¿™ä¸ªè¡¨å°±æ˜¯&lt;strong&gt;é¡µè¡¨&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;h4 id="æ’ç­‰æ˜ å°„"&gt;&lt;strong&gt;æ’ç­‰æ˜ å°„&lt;/strong&gt;ï¼š&lt;/h4&gt;
&lt;blockquote&gt;
&lt;p&gt;æ’ç­‰æ˜ å°„å³è™šæ‹Ÿåœ°å€=ç‰©ç†åœ°å€&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;å…ˆä»æ’ç­‰æ˜ å°„å¼€å§‹æ˜¯å› ä¸ºï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;ä» BootLoader/BIOS è·³è½¬åˆ°æ“ä½œç³»ç»Ÿ(å¦‚ Linux å†…æ ¸)å…¥å£æ—¶,MMU æ˜¯å…³é—­çš„ã€‚å…³é—­äº†MMU æ„å‘³ç€ä¸èƒ½åˆ©ç”¨é«˜é€Ÿç¼“å­˜çš„æ€§èƒ½ã€‚
&lt;strong&gt;MMU å…³é—­&lt;/strong&gt;: æ‰€æœ‰å†…å­˜è®¿é—®éƒ½æ˜¯ Non-cacheable,æ¯æ¬¡è®¿é—®ä¸»å­˜ ~100+ cyclesã€‚
&lt;strong&gt;MMU å¼€å¯&lt;/strong&gt;: é¡µè¡¨æ ‡è®°å†…å­˜ä¸º Cacheable,Cache å‘½ä¸­ ~3-5 cyclesã€‚
å› æ­¤,æˆ‘ä»¬åœ¨åˆå§‹åŒ–çš„æŸä¸ªé˜¶æ®µéœ€è¦æŠŠ MMU æ‰“å¼€å¹¶ä¸”ä½¿èƒ½æ•°æ®é«˜é€Ÿç¼“å­˜,ä»¥è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;em&gt;&lt;strong&gt;ä½†æ˜¯MMUå¼€å¯çš„ç¬é—´ï¼ŒCPUå‘é€çš„æ‰€æœ‰æŒ‡ä»¤éƒ½ä¼šè¢«ç¿»è¯‘ã€‚å¦‚æœVAâ‰ PAï¼ŒPCæŒ‡å‘çš„åœ°å€ä¼šæŒ‡å‘é”™è¯¯ä½ç½®ã€‚è¿™æ—¶å€™æ’ç­‰æ˜ å°„å°±æ´¾ä¸Šç”¨åœºäº†ï¼Œç¡®ä¿å¼€å¯å‰åä»£ç èƒ½æ­£å¸¸è¿è¡Œ&lt;/strong&gt;&lt;/em&gt;&lt;/p&gt;
&lt;h4 id="é¡µè¡¨"&gt;é¡µè¡¨&lt;/h4&gt;
&lt;p&gt;å‡è®¾æœ‰ä¸€ä¸ª&lt;code&gt;uint64_t table[512]&lt;/code&gt;,é€šè¿‡indexï¼Œæ•°ç»„è¿”å›ä¸€ä¸ªå€¼ã€‚é¡µè¡¨åŸç†ç±»ä¼¼ï¼ŒMMUæ‹¿åˆ°ä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œä»é‡Œé¢æ‰¾åˆ°å‡ ä¸ªbitå½“ä½œindexï¼Œä»é¡µè¡¨å»æŸ¥æ•°ç»„ï¼Œå¾—åˆ°ç»“æœã€‚å¦‚æœä¸€çº§æ•°ç»„æ¥è¦†ç›–æ•´ä¸ª48-bitåœ°å€ç©ºé—´ï¼Œéœ€è¦2^48ï¼Œä¸ç°å®ã€‚&lt;/p&gt;
&lt;p&gt;æ‰€ä»¥éœ€è¦ç”¨åˆ°&lt;strong&gt;å¤šçº§æ•°ç»„&lt;/strong&gt;ã€‚4KB garanuleæ˜¯ä¸€ä¸ªå››ç»´æ•°ç»„æŸ¥æ‰¾ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;table_L0[i0] -&amp;gt; æŒ‡å‘table_L1&lt;/li&gt;
&lt;li&gt;table_L1[i1] -&amp;gt; æŒ‡å‘table_L2&lt;/li&gt;
&lt;li&gt;table_L2[i2] -&amp;gt; æŒ‡å‘table_L3&lt;/li&gt;
&lt;li&gt;table_L3[i3] -&amp;gt; æœ€ç»ˆçš„ç‰©ç†é¡µåœ°å€&lt;/li&gt;
&lt;/ul&gt;
&lt;details open style="
border: 1px solid #448aff;
border-left: 4px solid #448aff; /* å·¦ä¾§åŠ ç²—çº¿ */
background-color: #f8f9fa;
border-radius: 4px;
margin: 1.5em 0;
padding: 0;
overflow: hidden;"&gt;
&lt;summary style="
background-color: #448aff1a; /* 10% é€æ˜åº¦èƒŒæ™¯ */
padding: 8px 12px;
font-weight: bold;
cursor: pointer;
color: #448aff;
outline: none;"&gt;
ä¸ºä»€ä¹ˆæ˜¯ 48-bit &amp;amp; 4çº§é¡µè¡¨ï¼Ÿ
&lt;/summary&gt;
&lt;div style="padding: 15px; background: #fff; color: #333;"&gt;
&lt;p&gt;&lt;strong&gt;1. åŸºç¡€é™åˆ¶&lt;/strong&gt;&lt;/p&gt;</description></item><item><title>5.GICä¸­æ–­</title><link>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/5.gic%E4%B8%AD%E6%96%AD/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/arm64-hypervisor%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/5.gic%E4%B8%AD%E6%96%AD/</guid><description>&lt;h4 id="ä»€ä¹ˆæ˜¯gic"&gt;ä»€ä¹ˆæ˜¯GIC&lt;/h4&gt;
&lt;p&gt;GIC(Generic Interrupt Controller)å³é€šç”¨ä¸­æ–­æ§åˆ¶å™¨ã€‚&lt;/p&gt;
&lt;p&gt;GICè´Ÿè´£æ¥å—æ¥è‡ªå¤–è®¾æˆ–è€…è½¯ä»¶çš„ä¸­æ–­ä¿¡å·ï¼Œè¿›è¡Œä¼˜å…ˆçº§æ’åºï¼Œå°†å…¶åˆ†å‘ç»™å¤„ç†å™¨æ ¸å¿ƒï¼ˆPEï¼‰ã€‚&lt;/p&gt;
&lt;p&gt;GICä½¿ç”¨ä¸­æ–­IDæ¥åˆ¤æ–­ä¸­æ–­æºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;SGI:ID 0-15ã€‚è½¯ä»¶ç”Ÿæˆçš„ä¸­æ–­ï¼Œé€šå¸¸ç”¨äºæ ¸é—´é€šä¿¡ï¼ˆIPIï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;PPI:ID 16-31ã€‚ç§æœ‰å¤–è®¾ä¸­æ–­ï¼Œç‰¹å®šç”¨äºæŸä¸ªæ ¸å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;SPI:ID 32-1019ã€‚å…±äº«å¤–è®¾ä¸­æ–­ï¼Œå¯ä»¥è·¯ç”±ç»™ä»»æ„æ ¸å¿ƒå’Œä¸€ç»„æ ¸å¿ƒã€‚&lt;/li&gt;
&lt;li&gt;LPI:ID 8192åŠä»¥ä¸Šã€‚&lt;strong&gt;GICv3&lt;/strong&gt;æ–°å¢çš„ï¼ŒåŸºäºæ¶ˆæ¯çš„ä¸­æ–­ï¼Œä¸»è¦ç”¨äºPCLe&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;ä¸­æ–­åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¤„äºä»¥ä¸‹å‡ ç§çŠ¶æ€ ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Inactive (éæ´»åŠ¨)&lt;/strong&gt;: ä¸­æ–­æœªå‘ç”Ÿã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Pending (æŒ‚èµ·)&lt;/strong&gt;: ä¸­æ–­å·²å‘ç”Ÿï¼Œç­‰å¾…æ ¸å¿ƒå¤„ç†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Active (æ´»åŠ¨)&lt;/strong&gt;: æ ¸å¿ƒå·²ç¡®è®¤ä¸­æ–­ï¼Œæ­£åœ¨å¤„ç†ä¸­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Active and Pending&lt;/strong&gt;: æ ¸å¿ƒæ­£åœ¨å¤„ç†è¯¥ä¸­æ–­ï¼Œä½†åŒæºçš„æ–°ä¸­æ–­åˆå‘ç”Ÿäº†ã€‚&lt;/li&gt;
&lt;li&gt;&lt;em&gt;æ³¨æ„ï¼šLPI æ²¡æœ‰ Active çŠ¶æ€ï¼Œåªæœ‰ Pending æˆ– Inactiveã€‚&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="ä»å¤–è®¾åˆ°cpuçš„æµæ°´çº¿"&gt;ä»å¤–è®¾åˆ°CPUçš„æµæ°´çº¿&lt;/h3&gt;
&lt;p&gt;GICv3ä¸­ï¼Œä¸‰ä¸ªç»„ä»¶æ„æˆäº†ä¸­æ–­ä»ç”Ÿäº§åˆ°è¢«CPUå¤„ç†çš„æµæ°´çº¿ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Distributor(å…¨å±€åˆ†å‘å™¨)&lt;/strong&gt;:æ ¹æ® &lt;code&gt;GICD_IROUTERn&lt;/code&gt; å¯„å­˜å™¨é…ç½®çš„äº²å’Œæ€§ï¼Œå°† SPI è·¯ç”±åˆ°ç‰¹å®šçš„ç›®æ ‡ PEã€‚åœ¨å¤šä¸ªæŒ‚èµ·çš„ SPI ä¸­ï¼Œé€‰å‡ºä¼˜å…ˆçº§æœ€é«˜çš„ SPIï¼Œå¹¶å°†å…¶æŒ‚èµ·çŠ¶æ€è½¬å‘ç»™å¯¹åº”çš„ Redistributorã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Redistributorï¼ˆæœ¬åœ°é‡åˆ†å‘å™¨ï¼‰&lt;/strong&gt;ï¼š&lt;strong&gt;ç¬¬äºŒçº§ï¼ˆèšåˆï¼‰ä»²è£&lt;/strong&gt;ï¼Œæ¥æ”¶æ¥è‡ª Distributor çš„æœ€é«˜ä¼˜å…ˆçº§ SPIï¼Œå°†å…¶ä¸æœ¬åœ°æŒ‚èµ·çš„æœ€é«˜ä¼˜å…ˆçº§ PPIã€SGI å’Œ LPI è¿›è¡Œç»¼åˆæ¯”è¾ƒï¼Œé€‰å‡ºè¯¥ PE è§†è§’ä¸‹çš„&lt;strong&gt;ç»å¯¹æœ€é«˜ä¼˜å…ˆçº§ä¸­æ–­&lt;/strong&gt;ï¼Œå¹¶å°†å…¶å‘å¾€ CPU Interfaceã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;CPU Interface (CPU æ¥å£)&lt;/strong&gt;ï¼šGIC ä¸ PE æ ¸å¿ƒå†…éƒ¨æµæ°´çº¿äº¤äº’çš„ç›´æ¥ç‰©ç†/é€»è¾‘æ¥å£ã€‚
&lt;img src="https://human-mean.github.io/posts/ARM64%20Hypervisor%e5%ad%a6%e4%b9%a0%e8%ae%b0%e5%bd%95/images/gic_architecture.png" alt="" loading="lazy" /&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="é˜…è¯»ihi0069h_"&gt;é˜…è¯»&lt;em&gt;IHI0069H_b_gic_architecture_specification&lt;/em&gt;&lt;/h3&gt;
&lt;h4 id="distributor"&gt;Distributor&lt;/h4&gt;
&lt;h5 id="gicd_"&gt;&lt;strong&gt;GICD_CTRL&lt;/strong&gt;:&lt;/h5&gt;
&lt;p&gt;GICD_CTRLæ˜¯Distributorçš„&lt;strong&gt;æ§åˆ¶å¯„å­˜å™¨&lt;/strong&gt;ã€‚&lt;/p&gt;</description></item><item><title>NerdRTOS å®šæ—¶å™¨è®¾è®¡æ–‡æ¡£</title><link>https://human-mean.github.io/posts/nerdrtos/nerdrtos%E5%AE%9A%E6%97%B6%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/nerdrtos/nerdrtos%E5%AE%9A%E6%97%B6%E5%99%A8%E8%AE%BE%E8%AE%A1%E6%96%87%E6%A1%A3/</guid><description>&lt;h1 id="nerdrtos-å®šæ—¶å™¨å­ç³»ç»Ÿè®¾è®¡æ–‡æ¡£"&gt;NerdRTOS å®šæ—¶å™¨å­ç³»ç»Ÿè®¾è®¡æ–‡æ¡£&lt;/h1&gt;
&lt;h2 id="1-æ¦‚è¿°"&gt;1. æ¦‚è¿°&lt;/h2&gt;
&lt;p&gt;NerdRTOS çš„å®šæ—¶å™¨å­ç³»ç»Ÿæ—¨åœ¨ä¸ºå†…æ ¸åŠåº”ç”¨ç¨‹åºæä¾›ç²¾ç¡®çš„æ—¶é—´ç®¡ç†æœåŠ¡ã€‚è¯¥ç³»ç»Ÿè®¾è®¡äº†ä¸¤ç§å·¥ä½œæ¨¡å¼â€”â€”**Tick æ¨¡å¼ï¼ˆä¼ ç»ŸèŠ‚æ‹ï¼‰**ä¸ &lt;strong&gt;Tickless æ¨¡å¼ï¼ˆåŠ¨æ€æ—¶é’Ÿï¼‰&lt;/strong&gt;ï¼Œä»¥é€‚åº”ä»èµ„æºå—é™çš„å¾®æ§åˆ¶å™¨åˆ°å¯¹åŠŸè€—æ•æ„Ÿçš„ç°ä»£ SoC ç­‰ä¸åŒåº”ç”¨åœºæ™¯ã€‚&lt;/p&gt;
&lt;p&gt;ç³»ç»Ÿçš„æ ¸å¿ƒä¸ä»…ä»…æ˜¯ç®€å•çš„é“¾è¡¨ç®¡ç†ï¼Œè€Œæ˜¯é‡‡ç”¨äº†**çº¢é»‘æ ‘ï¼ˆRed-Black Treeï¼‰**ä½œä¸ºå®šæ—¶å™¨å®¹å™¨ï¼Œæ˜¾è‘—æå‡äº†åœ¨å¤§é‡å®šæ—¶å™¨å¹¶å‘åœºæ™¯ä¸‹çš„æ’å…¥ä¸æŸ¥æ‰¾æ•ˆç‡ã€‚&lt;/p&gt;
&lt;h2 id="2-æ ¸å¿ƒæ•°æ®ç»“æ„"&gt;2. æ ¸å¿ƒæ•°æ®ç»“æ„&lt;/h2&gt;
&lt;p&gt;å®šæ—¶å™¨å­ç³»ç»Ÿçš„è®¾è®¡å›´ç»• &lt;code&gt;nd_timer_t&lt;/code&gt; ç»“æ„ä½“å±•å¼€ï¼Œé‡‡ç”¨äº†éä¾µå…¥å¼çš„èŠ‚ç‚¹è®¾è®¡ï¼Œç›´æ¥åµŒå…¥å†…æ ¸çš„é€šç”¨æ•°æ®ç»“æ„ã€‚&lt;/p&gt;
&lt;h3 id="21-å®šæ—¶å™¨æ§åˆ¶å—-nd_timer_t"&gt;2.1 å®šæ—¶å™¨æ§åˆ¶å— (&lt;code&gt;nd_timer_t&lt;/code&gt;)&lt;/h3&gt;
&lt;p&gt;å®šä¹‰äº &lt;code&gt;include/nd_def.h&lt;/code&gt;ï¼Œè¯¥ç»“æ„ä½“åŒ…å«ä»¥ä¸‹å…³é”®æˆå‘˜ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;struct rb_node node&lt;/code&gt;&lt;/strong&gt;ï¼šçº¢é»‘æ ‘èŠ‚ç‚¹ï¼Œç”¨äºå°†å®šæ—¶å™¨æŒ‚è½½åˆ°å†…æ ¸çš„å…¨å±€å®šæ—¶å™¨æ ‘ä¸Šã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;nd_uint64_t expire_time&lt;/code&gt;&lt;/strong&gt;ï¼šç»å¯¹åˆ°æœŸæ—¶é—´ã€‚å†…æ ¸ç»Ÿä¸€å°†ç”¨æˆ·è®¾ç½®çš„ç›¸å¯¹è¶…æ—¶æ—¶é—´è½¬æ¢ä¸ºç³»ç»Ÿå¯åŠ¨ä»¥æ¥çš„ç»å¯¹æ—¶é—´æˆ³ï¼ˆTicks æˆ–å¾®ç§’ï¼‰ï¼Œä»¥æ­¤ä½œä¸ºçº¢é»‘æ ‘æ’åºçš„é”®å€¼ï¼ˆKeyï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;&lt;code&gt;nd_timer_type_t type&lt;/code&gt;&lt;/strong&gt;ï¼šå®šæ—¶å™¨ç±»å‹ï¼Œæ”¯æŒå•æ¬¡è§¦å‘ï¼ˆ&lt;code&gt;ND_TIMER_TYPE_ONE_SHOT&lt;/code&gt;ï¼‰å’Œå‘¨æœŸè§¦å‘ï¼ˆ&lt;code&gt;ND_TIMER_TYPE_PERIODIC&lt;/code&gt;ï¼‰ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å›è°ƒæœºåˆ¶&lt;/strong&gt;ï¼šåŒ…å«å‡½æ•°æŒ‡é’ˆ &lt;code&gt;callback&lt;/code&gt; å’Œå‚æ•° &lt;code&gt;arg&lt;/code&gt;ï¼Œåœ¨å®šæ—¶å™¨åˆ°æœŸæ—¶æ‰§è¡Œã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="22-å…¨å±€å®¹å™¨-rbtree_root"&gt;2.2 å…¨å±€å®¹å™¨ (&lt;code&gt;rbtree_root&lt;/code&gt;)&lt;/h3&gt;
&lt;p&gt;å†…æ ¸ç»´æŠ¤ä¸€ä¸ªé™æ€å…¨å±€å˜é‡ &lt;code&gt;rbtree_root&lt;/code&gt;ï¼ˆå®šä¹‰äº &lt;code&gt;kernel/nd_timer.c&lt;/code&gt;ï¼‰ã€‚æ‰€æœ‰æ´»åŠ¨çš„å®šæ—¶å™¨éƒ½é©»ç•™åœ¨è¿™æ£µçº¢é»‘æ ‘ä¸­ã€‚
ä½¿ç”¨çº¢é»‘æ ‘çš„ä¼˜åŠ¿åœ¨äºï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æŸ¥æ‰¾æœ€ä¼˜&lt;/strong&gt;ï¼šè·å–æœ€æ—©åˆ°æœŸçš„å®šæ—¶å™¨ï¼ˆå³æ ‘çš„æœ€å·¦èŠ‚ç‚¹ &lt;code&gt;rb_first&lt;/code&gt;ï¼‰çš„æ—¶é—´å¤æ‚åº¦æä½ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;æ“ä½œç¨³å®š&lt;/strong&gt;ï¼šæ’å…¥å’Œåˆ é™¤å®šæ—¶å™¨çš„æ—¶é—´å¤æ‚åº¦ä¸º ï¼Œé¿å…äº†ä¼ ç»ŸåŒå‘é“¾è¡¨åœ¨é•¿åˆ—è¡¨ä¸‹çš„éå†å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="3-è¿è¡Œæ¨¡å¼è¯¦è§£"&gt;3. è¿è¡Œæ¨¡å¼è¯¦è§£&lt;/h2&gt;
&lt;p&gt;ç³»ç»Ÿé€šè¿‡å® &lt;code&gt;ND_CFG_TICKLESS&lt;/code&gt; è¿›è¡Œç¼–è¯‘æœŸé…ç½®ï¼Œå†³å®šåº•å±‚æ—¶é’Ÿé©±åŠ¨æœºåˆ¶ã€‚&lt;/p&gt;
&lt;h3 id="31-tick-æ¨¡å¼"&gt;3.1 Tick æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;å½“ &lt;code&gt;ND_CFG_TICKLESS&lt;/code&gt; ä¸º 0 æ—¶ï¼Œç³»ç»Ÿå·¥ä½œåœ¨å›ºå®šèŠ‚æ‹æ¨¡å¼ã€‚&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;æ—¶åŸºé©±åŠ¨&lt;/strong&gt;ï¼šä¾èµ–ç¡¬ä»¶çš„å‘¨æœŸæ€§ä¸­æ–­ï¼ˆå¦‚ SysTickï¼‰ã€‚åœ¨ &lt;code&gt;arch/arm/m33/port.c&lt;/code&gt; ä¸­ï¼ŒSystick è¢«é…ç½®ä¸ºä»¥ &lt;code&gt;ND_TICKS_PER_SEC&lt;/code&gt; çš„é¢‘ç‡äº§ç”Ÿä¸­æ–­ã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;å¤„ç†æµç¨‹&lt;/strong&gt;ï¼š
æ¯æ¬¡ Systick ä¸­æ–­è§¦å‘ &lt;code&gt;isr_systick&lt;/code&gt;ï¼Œè¿›è€Œè°ƒç”¨ &lt;code&gt;nd_timer_process()&lt;/code&gt;ã€‚å†…æ ¸é€šè¿‡ &lt;code&gt;nd_hw_tick_get_current()&lt;/code&gt; è·å–å½“å‰ Tick è®¡æ•°ï¼Œå¹¶æ£€æŸ¥çº¢é»‘æ ‘æœ€å·¦èŠ‚ç‚¹æ˜¯å¦åˆ°æœŸã€‚&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;ç‰¹ç‚¹&lt;/strong&gt;ï¼šå®ç°ç®€å•ï¼Œä½†å­˜åœ¨ç©ºé—²æ—¶çš„æ— æ•ˆä¸­æ–­å¼€é”€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id="32-tickless-æ¨¡å¼"&gt;3.2 Tickless æ¨¡å¼&lt;/h3&gt;
&lt;p&gt;å½“ &lt;code&gt;ND_CFG_TICKLESS&lt;/code&gt; ä¸º 1 æ—¶ï¼Œç³»ç»Ÿå¯ç”¨é«˜ç²¾åº¦åŠ¨æ€å®šæ—¶æ¨¡å¼ã€‚&lt;/p&gt;</description></item><item><title>å“ˆå¸Œè¡¨</title><link>https://human-mean.github.io/posts/c%E8%AF%AD%E8%A8%80/%E5%93%88%E5%B8%8C%E8%A1%A8/</link><pubDate>Tue, 03 Feb 2026 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/posts/c%E8%AF%AD%E8%A8%80/%E5%93%88%E5%B8%8C%E8%A1%A8/</guid><description>&lt;h3 id="å“ˆå¸Œè¡¨æ˜¯ä»€ä¹ˆ"&gt;å“ˆå¸Œè¡¨æ˜¯ä»€ä¹ˆ&lt;/h3&gt;
&lt;p&gt;å“ˆå¸Œè¡¨é€šè¿‡å»ºç«‹é”®Â &lt;code&gt;key&lt;/code&gt;Â ä¸å€¼Â &lt;code&gt;value&lt;/code&gt;Â ä¹‹é—´çš„æ˜ å°„ï¼Œå®ç°é«˜æ•ˆçš„å…ƒç´ æŸ¥è¯¢ï¼Œåªéœ€è¦è¾“å…¥ä¸€ä¸ª&lt;code&gt;key&lt;/code&gt;å°±èƒ½è·å¾—å¯¹åº”å€¼çš„valueã€‚ã€€&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å“ˆå¸Œè¡¨ä¸é“¾è¡¨ã€æ•°ç»„çš„æ—¶é—´å¤æ‚åº¦æ¯”è¾ƒï¼š&lt;/p&gt;
&lt;/blockquote&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;&lt;/th&gt;
&lt;th&gt;æ•°ç»„&lt;/th&gt;
&lt;th&gt;é“¾è¡¨&lt;/th&gt;
&lt;th&gt;å“ˆå¸Œè¡¨&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;æŸ¥æ‰¾å…ƒç´ &lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;æ·»åŠ å…ƒç´ &lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;åˆ é™¤å…ƒç´ &lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;O(n)&lt;/td&gt;
&lt;td&gt;O(1)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id="å“ˆå¸Œå‡½æ•°"&gt;å“ˆå¸Œå‡½æ•°&lt;/h3&gt;
&lt;p&gt;ä¸€ä¸ª&lt;strong&gt;æŠŠæ•°æ®è½¬æ¢æˆæ•°ç»„ä¸‹æ ‡&lt;/strong&gt;çš„è§„åˆ™ï¼Œåªæœ‰ä¸¤ä¸ªè¦æ±‚ï¼š&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;åŒæ ·çš„è¾“å…¥ï¼Œæ°¸è¿œå¾—åˆ°åŒæ ·çš„è¾“å‡º&lt;/li&gt;
&lt;li&gt;è¾“å‡ºèŒƒå›´åœ¨ &lt;code&gt;0&lt;/code&gt; åˆ° &lt;code&gt;size-1&lt;/code&gt; ä¹‹é—´&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;è¾“å…¥ä¸€ä¸ªkeyï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å“ˆå¸Œå‡½æ•°è·å¾—keyå€¼å¯¹åº”é”®å€¼çš„å­˜å‚¨ä½ç½®ã€‚&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°çš„è®¡ç®—æ­¥éª¤ï¼š&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;1.é€šè¿‡ä¸€ä¸ªå“ˆå¸Œç®—æ³•&lt;code&gt;hash()&lt;/code&gt;å¾—åˆ°å“ˆå¸Œå€¼ã€‚
2.å°†å“ˆå¸Œå€¼çš„æ•°ç»„é•¿åº¦&lt;code&gt;capacity&lt;/code&gt;å–æ¨¡ï¼Œä»è€Œè·å–å¯¹åº”çš„&lt;code&gt;index&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;code&gt;index = hash(key) % capacity&lt;/code&gt;&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;p&gt;å› ä¸ºå“ˆå¸Œå‡½æ•°å¯èƒ½ç®—å‡ºå¾ˆå¤§çš„æ•°ï¼Œä½†æ•°ç»„ä¸‹æ ‡æ˜¯æœ‰é™çš„ã€‚å–æ¨¡å¯ä»¥æŠŠä»»æ„å¤§çš„æ•°å‹ç¼©åˆ° &lt;code&gt;0&lt;/code&gt; åˆ° &lt;code&gt;capacity-1&lt;/code&gt; çš„èŒƒå›´å†…ã€‚&lt;/p&gt;
&lt;!-- raw HTML omitted --&gt;
&lt;h3 id="å“ˆå¸Œå†²çªä¸æ‰©å®¹"&gt;å“ˆå¸Œå†²çªä¸æ‰©å®¹&lt;/h3&gt;
&lt;p&gt;å“ˆå¸Œå‡½æ•°çš„ä½œç”¨æ˜¯å°†æ‰€æœ‰Â &lt;code&gt;key&lt;/code&gt;Â æ„æˆçš„è¾“å…¥ç©ºé—´æ˜ å°„åˆ°æ•°ç»„æ‰€æœ‰ç´¢å¼•æ„æˆçš„è¾“å‡ºç©ºé—´ï¼Œè€Œè¾“å…¥ç©ºé—´å¾€å¾€è¿œå¤§äºè¾“å‡ºç©ºé—´ã€‚å› æ­¤&lt;strong&gt;ç†è®ºä¸Šä¸€å®šå­˜åœ¨å¤šä¸ªè¾“å…¥å¯¹åº”ç›¸åŒè¾“å‡ºçš„æƒ…å†µ&lt;/strong&gt;ã€‚&lt;/p&gt;
&lt;p&gt;æ¯”å¦‚ï¼š&lt;/p&gt;
&lt;pre tabindex="0"&gt;&lt;code&gt;7 % 10 = 7
17 % 10 = 7
&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;å“ˆå¸Œè¡¨å®¹é‡è¶Šå¤§ï¼Œè¾“å‡ºç›¸åŒçš„å¯èƒ½æ€§å°±è¶Šä½ï¼Œé€šè¿‡&lt;em&gt;æ‰©å®¹å“ˆå¸Œè¡¨&lt;/em&gt;å¯ä»¥å‡å°‘&lt;em&gt;å“ˆå¸Œå†²çª&lt;/em&gt;&lt;/p&gt;</description></item><item><title/><link>https://human-mean.github.io/readme/</link><pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate><guid>https://human-mean.github.io/readme/</guid><description>&lt;p&gt;#Init&lt;/p&gt;</description></item></channel></rss>